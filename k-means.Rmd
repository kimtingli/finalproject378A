---
title: "K-means"
author: "Adrián Díaz"
date: "28 de octubre de 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Setup1}
install.packages("rattle")
```

```{r Setup2}
install.packages("rattle.data")
install.packages("fpc")
```

```{r Setup3}
library(rattle.data)
data(wine)
```

```{r Setup4}
library(fpc)
```

```{r Setup5}
winedata<-as.matrix(wine)
Type<-winedata[,1]
winedata<-winedata[,-1]
winedata<-t(winedata)
class(winedata)<-"numeric"
class(Type)<-"numeric"
winemat<-as.matrix(wine)
View(winedata)
wineback<-t(winedata)
wineback<-cbind2(Type,wineback)
View(wineback)
```

```{r Distance}
eucdist<-function(x,y) {
  x_y2<-(x-y)*(x-y)
  eucdist<-sqrt(sum(x_y2))
  return(eucdist)
}
discdist<-function(x,y) {
  if (x==y) {
    disctdist=0
  } else {
    discdist=1
  }
}
```

```{r kmeans}
truetypes<-function(x) {
  trueclass<<-as.matrix(x)
  trueclass<<-trueclass[,1]
}
randomtype<-function(x,k=3) {
  db<<-as.matrix(x)
  db<<-db[,-1]
  randvar<-ceiling(k*runif(nrow(db)))
  db<<-cbind2(randvar,db)
  db<<-data.frame(db)
  return(db)
}
centertype<-function(x) {
  ddb<<-x
  ddb<<-ddb[,-1]
  randvar<<-runif(nrow(ddb))
  ddb<<-cbind(randvar,ddb)
  colnames(ddb)<-c("randvar","Alcohol","Malic","Ash","Alcalinity","Magnesium","Phenols","Flavanoids","Nonflavanoids","Proanthocyanins","Color","Hue","Dilution","Proline")
  ddb[with(ddb,order(ddb$randvar))]
  rownames(ddb)<-1:nrow(ddb)
  class(ddb)<<-"numeric"
  centroidtype1<<-ddb[(2*nrow(ddb))/4,]
  centroidtype2<<-ddb[1,]
  centroidtype3<<-ddb[nrow(ddb),]
  centroidtype<<-cbind(centroidtype1,centroidtype2,centroidtype3)
  class(centroidtype)<<-"numeric"
  return(centroidtype)
}
selectype<-function(x,r1=centertype(randomtype(x))[1],r2=centertype(randomtype(x))[2],r3=centertype(randomtype(x))[3]) {
  bd<<-as.matrix(x)
  bd<<-bd[,-1]
  bd<<-t(bd)
  class(bd)<<-"numeric"
  types<<-c()
  for (i in 1:nrow(x)) {
    if (min(c(eucdist(bd[,i],r1),eucdist(bd[,i],r2),eucdist(bd[,i],r3)))==eucdist(bd[,i],r1)) {
      types<<-c(types,1)
    } else if (min(c(eucdist(bd[,i],r1),eucdist(bd[,i],r2),eucdist(bd[,i],r3)))==eucdist(bd[,i],r2)) {
      types<<-c(types,2)
    } else {
      types<<-c(types,3)
    }
  }
  return(types)
}
kavg<-function(x) {
  tipos<<-cbind2(0,selectype(x))
  trueclass<<-truetypes(x)
  class(trueclass)<<-"numeric"
  i<-2
  while (eucdist(tipos[,i-1],tipos[,i])>0) {
    datos<<-as.matrix(x)
    datos<<-datos[,-1]
    datos<<-cbind2(tipos[,ncol(tipos)],datos)
    datos<<-data.frame(datos)
    currentcenter<<-centertype(datos)
    tipos<<-cbind2(tipos,selectype(datos,currentcenter[,1],currentcenter[,2],currentcenter[,3]))
    i<-i+1
  }
  finaltype<<-tipos[,ncol(tipos)]
  print(ncol(tipos))
  misclass<<-abs(trueclass-finaltype)
  for (i in 1:length(trueclass)) {
    if (misclass[i]>0) {
        misclass[i]=1
    }
  }
  misclassrate<<-sum(misclass)/length(trueclass)
  print(misclassrate)
  return(finaltype)
}
```
